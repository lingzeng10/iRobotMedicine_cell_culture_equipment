// Prisma 資料模型設計
generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "sqlite"
  url      = "file:./dev.db"
}

// 工單資料模型
model Ticket {
  id          String   @id @default(cuid()) // 工單唯一識別碼
  deviceId    String   // 設備 ID
  imageId     String?  // 影像 ID（可選）
  status      String   @default("OPEN") // 工單狀態，預設為 OPEN
  magnification String? // 拍照倍數（僅 AOI 工單使用，可選：4X, 10X, 20X）
  photoCount    Int?     // 張數（僅 AOI 工單使用，可選：3, 6, 9, 12, 16, 20, 27）
  mediumType    String?  // 培養液種類（僅換液工單使用，可選：022-02.4, 022-02.1, SAM10, CM2, AM5）
  recycledMediumType String? // 回收培養液種類（僅換液工單使用，可選：022-02.4, 022-02.1, SAM10, CM2, AM5）
  parentBoxCount Int? // 親代盒數（僅繼代凍存工單使用）
  childBoxCount Int? // 子代盒數（僅繼代凍存工單使用）
  subcultureMediumType String? // 繼代培養液種類（僅繼代凍存工單使用，可選：022-02.4, 022-02.1, SAM10, CM2, AM5）
  subcultureRecycledMediumType String? // 回收培養液種類（僅繼代凍存工單使用，可選：022-02.4, 022-02.1, SAM10, CM2, AM5, 不回收）
  frozenCellBoxCount Int? // 凍存細胞盒數（僅繼代凍存工單使用）
  frozenTubeSpec String? // 凍管規格（僅繼代凍存工單使用，可選：2ml, 5ml）
  frozenMediumType String? // 凍液種類（僅繼代凍存工單使用，可選：凍液A, 凍液B）
  frozenTubeCount Int? // 凍管支數（僅繼代凍存工單使用）
  thawCellName String? // 解凍細胞（僅解凍工單使用）
  thawCellGeneration Int? // 細胞凍存代數（僅解凍工單使用）
  thawOriginalMediumType String? // 細胞凍存原培養液（僅解凍工單使用，可選：022-02.4, 022-02.1, SAM10, CM2, AM5, 無紀錄）
  thawFreezeDate String? // 凍管凍存日期（僅解凍工單使用）
  thawTubeCount Int? // 解凍支數（僅解凍工單使用）
  thawMediumType String? // 解凍培養液（僅解凍工單使用，可選：022-02.4, 022-02.1, SAM10, CM2, AM5）
  thawCultureBoxCount Int? // 解凍培養盒數（僅解凍工單使用）
  freezeBoxCount Int? // 凍存盒數（僅凍存工單使用）
  freezeTubeCount Int? // 凍管數量（僅凍存工單使用）
  freezeTubeSpec String? // 凍管規格（僅凍存工單使用，可選：2ml, 5ml）
  freezeMediumType String? // 凍液種類（僅凍存工單使用，可選：凍液A, 凍液B）
  subParentBoxCount Int? // 親代盒數（僅繼代工單使用）
  subChildBoxCount Int? // 子代盒數（僅繼代工單使用）
  subMediumType String? // 繼代培養液種類（僅繼代工單使用，可選：022-02.4, 022-02.1, SAM10, CM2, AM5）
  subRecycledMediumType String? // 回收培養液種類（僅繼代工單使用，可選：022-02.4, 022-02.1, SAM10, CM2, AM5, 不回收）
  collectDiscardBoxCount Int? // 回收/丟盒數（僅回收/丟棄工單使用）
  collectDiscardRecycledMediumType String? // 回收培養液種類（僅回收/丟棄工單使用，可選：022-02.4, 022-02.1, SAM10, CM2, AM5）
  createdAt   DateTime @default(now()) // 建立時間
  updatedAt   DateTime @updatedAt // 更新時間
  
  // 關聯到工單排程和照片
  schedules   TicketSchedule[] // 工單排程關聯
  photos      Photo[] // 工單照片關聯
}

// 預生產目標資料模型
model ProductionTarget {
  id                      String   @id @default(cuid()) // 目標唯一識別碼
  name                    String   // 目標名稱
  materialType            String?  // 收集原料種類（可選）
  responsiblePerson       String?  // 負責人員（可選：OP001, OP002, OP003）
  expectedCompletionDate  String   // 預計完成時間
  status                  String   @default("PLANNING") // 目標狀態，預設為 PLANNING
  createdAt               DateTime @default(now()) // 建立時間
  updatedAt               DateTime @updatedAt // 更新時間
  
  // 關聯到工單排程
  schedules               TicketSchedule[] // 目標排程關聯
}

// 工單排程資料模型
model TicketSchedule {
  id              String   @id @default(cuid()) // 排程唯一識別碼
  ticketId        String   // 工單 ID
  targetId        String   // 預生產目標 ID
  scheduledDate   String   // 排程日期
  scheduledTime   String?  // 排程時間（可選）
  priority        String   @default("MEDIUM") // 優先級，預設為 MEDIUM
  status          String   @default("OPEN") // 排程狀態，預設為 OPEN
  createdAt       DateTime @default(now()) // 建立時間
  updatedAt       DateTime @updatedAt // 更新時間
  
  // 關聯到工單和目標
  ticket          Ticket           @relation(fields: [ticketId], references: [id], onDelete: Cascade)
  target          ProductionTarget @relation(fields: [targetId], references: [id], onDelete: Cascade)
}

// 照片資料模型
model Photo {
  id            String   @id @default(cuid()) // 照片唯一識別碼
  ticketId      String   // 工單 ID
  filename      String   // 存儲文件名
  originalName  String   // 原始文件名
  filePath      String   // 文件路徑
  fileSize      Int      // 文件大小（字節）
  mimeType      String   // MIME類型
  description   String?  // 照片描述（可選）
  uploadedAt    DateTime @default(now()) // 上傳時間
  
  // 關聯到工單
  ticket        Ticket   @relation(fields: [ticketId], references: [id], onDelete: Cascade)
}

// 工單狀態：使用字串 "OPEN" 或 "CLOSED"
// 目標狀態：使用字串 "PLANNING", "IN_PROGRESS", "COMPLETED", "CANCELLED"
// 排程優先級：使用字串 "HIGH", "MEDIUM", "LOW"
